$dhx.ui.mvp.presenters.declare({servers:function(){"strict";var e="servers",t="servers",r={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var t=this;t.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(r,o){var i=$dhx.ui.mvp.presenters.get(e),n=i.view;if(console.log(e+"Child Presenter Received Message: ",o),o.collection==t)if("create"==o.method){var s=[];n._settings.grid.id.forEach(function(e){s.push(o.model[e])}),console.log(o),n.grid.addRow(o.model.id||o.model._id,s,0)}else if("update"==o.method){if(n._settings.grid.id.forEach(function(e,t){n.grid.cells(o.model.id,n.grid.getColIndexById(e)).setValue(o.model[e])}),n.form_item){setTimeout(function(){i.show_item()},300)}}else"destroy"==o.method&&n.grid.deleteRow(o.model.id);else"providers"==o.collection&&("create"==o.method||"update"==o.method||"destroy"==o.method)},toolbarOnClickHandler:function(t){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,"destroy"!=t?r.mount_form_input_ui(t):"destroy"==t&&(this.disableItem("destroy"),r.delete_item({onSuccess:function(){r.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var r,o=$dhx.ui.mvp.presenters.get(e),i=o.view,n=i.form.getFormData();if(i.form.check()){i.form.lock(),r={};for(var s in n)r[s]=n[s];"update"==i.form.action&&(r.id=i.grid.getSelectedRowId()),r.expiration&&(r.expiration=new Date(r.expiration).getTime()),r.purchase&&(r.purchase=new Date(r.purchase).getTime()),r.price&&(r.price=+(r.price||0).replace(/,/g,"")),console.log(i.form.action),o.model.schema.io[t][i.form.action]({record:r,onSuccess:function(){i.form.isItemChecked("close_on_save")?i.window.close():(i.form.reset(),i.form.unlock())},onFail:function(){i.form.unlock()}})}},formOnButtonClickHandler:function(t){"save"==t?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==t&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},mount_form_input_ui:function(r){var o=$dhx.ui.mvp.presenters.get(e),i=o.view,n=i._window();i.window.setText(("create"==r?"Add new":"Edit")+" Server"),i._form(n,r),i.form.lock(),o.model.schema.io.providers.readAll({onSuccess:function(e,n,s){var d=i.form.getCombo("provider");d.addOption(n.map(function(e){return[e.id,e.name]})),o.get_selected_provider()&&d.selectOption(d.getIndexByValue(o.get_selected_provider()),!0,!0),i.form.disableItem("provider"),"update"==r?o.model.schema.io[t].read({record:{id:i.grid.getSelectedRowId()},onSuccess:function(e){var t=e.toJSON();delete t.id,delete t._id,delete t.__v,t.expiration=new Date(t.expiration),t.purchase=new Date(t.purchase),i.form.setFormData(t),i.form.unlock(),i.form.setFocusOnFirstActive()},onFail:function(){}}):(i.form.unlock(),i.form.setFocusOnFirstActive())},onFail:function(){}})},delete_item:function(r){var o=$dhx.ui.mvp.presenters.get(e);view=o.view,o.model.schema.io[t].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){r.onSuccess&&r.onSuccess()},onFail:function(){r.onFail&&r.onFail()}})},gridOnRowSelectHandler:function(t){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,r.selected_server=t,r.show_item(),$dhx.ui.mvp.views.get("ip").toolbar.enableItem("create"),$dhx.ui.mvp.presenters.get("ip").fill_grid()},toolbar_itemOnClickHandler:function(t){var r=$dhx.ui.mvp.presenters.get(e);r.view;"close"==t&&r.destroy_item()},show_item:function(){var e=this,r=e.view;r.layout.cells("b").progressOn(),e.model.schema.io[t].read({record:{id:r.grid.getSelectedRowId()},onSuccess:function(e){r.layout.cells("b").setText(e.get("name")),$dhx.ui.mvp.ui.isMobile?(r.layout.cells("a").collapse(),r.layout.cells("b").expand()):r.layout.cells("b").expand(),r._toolbar_item(),r._form_item(e),r.toolbar.enableItem("update"),r.toolbar.enableItem("destroy"),r.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,t=e.view;t.layout&&(t.layout.cells("b").collapse(),t.layout.cells("b").setText("Select a Server first")),t.form_item&&(t.form_item.unload(),t.form_item=null)},fill_grid:function(e){var r=this,o=r.view;o.grid.clearAll(),r.model.data[t]().fetch({sort:{index:"provider",order:1},filter:function(e){if(e.provider==r.get_selected_provider())return e},success:function(t,r,i){t.models.forEach(function(e){var t=[];o._settings.grid.id.forEach(function(r){"purchase"==r||"expiration"==r?t.push(new Date(e.get(r))):t.push($dhx.strip_tags(e.get(r)))}),o.grid.addRow(e.get("id"),t)}),o.grid.adjustColumnSize(o.grid.getColIndexById("name")),e&&e()},error:function(e,t,r){}})},selected_server:null,get_selected_provider:function(){return $dhx.ui.mvp.presenters.get("providers").selected_provider},get_selected_server:function(){return $dhx.ui.mvp.presenters.get("servers").selected_server}};return r}()});