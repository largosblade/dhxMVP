$dhx.ui.mvp.presenters.declare({servers:function(){"strict";var e="servers",r="servers",t={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var r=this;r.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(t,o){var i=$dhx.ui.mvp.presenters.get(e),s=i.view;if(console.log(e+"Child Presenter Received Message: ",o),o.collection==r)if("create"==o.method){var n=[];s._settings.grid.id.forEach(function(e){n.push(o.model[e])}),console.log(o),s.grid.addRow(o.model.id||o.model._id,n,0)}else if("update"==o.method){if(s._settings.grid.id.forEach(function(e,r){s.grid.cells(o.model.id,s.grid.getColIndexById(e)).setValue(o.model[e])}),s.form_item){setTimeout(function(){i.show_item()},300)}}else"destroy"==o.method&&s.grid.deleteRow(o.model.id);else"providers"==o.collection&&("create"==o.method||"update"==o.method||"destroy"==o.method)},toolbarOnClickHandler:function(r){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,"destroy"!=r?t.mount_form_input_ui(r):"destroy"==r&&(this.disableItem("destroy"),t.delete_item({onSuccess:function(){t.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var t,o=$dhx.ui.mvp.presenters.get(e),i=o.view,s=i.form.getFormData();if(i.form.check()){i.form.lock(),t={};for(var n in s)t[n]=s[n];"update"==i.form.action&&(t.id=i.grid.getSelectedRowId()),t.expiration&&(t.expiration=new Date(t.expiration).getTime()),t.purchase&&(t.purchase=new Date(t.purchase).getTime()),t.price&&(t.price=+(t.price||0).replace(/,/g,"")),console.log(i.form.action),o.model.schema.io[r][i.form.action]({record:t,onSuccess:function(){i.form.isItemChecked("close_on_save")?i.window.close():(i.form.reset(),i.form.unlock())},onFail:function(){i.form.unlock()}})}},formOnButtonClickHandler:function(r){"save"==r?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==r&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},mount_form_input_ui:function(t){var o=$dhx.ui.mvp.presenters.get(e),i=o.view,s=i._window();i.window.setText(("create"==t?"Add new":"Edit")+" Server"),i._form(s,t),i.form.lock(),o.model.schema.io.providers.readAll({onSuccess:function(e,s,n){var d=i.form.getCombo("provider");d.addOption(s.map(function(e){return[e.id,e.name]})),o.get_selected_provider()&&d.selectOption(d.getIndexByValue(o.get_selected_provider()),!0,!0),i.form.disableItem("provider"),"update"==t?o.model.schema.io[r].read({record:{id:i.grid.getSelectedRowId()},onSuccess:function(e){var r=e.toJSON();delete r.id,delete r._id,delete r.__v,r.expiration=new Date(r.expiration),r.purchase=new Date(r.purchase),i.form.setFormData(r),i.form.unlock(),i.form.setFocusOnFirstActive()},onFail:function(){}}):(i.form.unlock(),i.form.setFocusOnFirstActive())},onFail:function(){}})},delete_item:function(t){var o=$dhx.ui.mvp.presenters.get(e);view=o.view,o.model.schema.io[r].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){t.onSuccess&&t.onSuccess()},onFail:function(){t.onFail&&t.onFail()}})},gridOnRowSelectHandler:function(r){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,t.selected_server=r,t.show_item(),$dhx.ui.mvp.views.get("ip").grid&&$dhx.ui.mvp.views.get("ip").grid.clearAll(),$dhx.ui.mvp.views.get("providers").layout_servers.cells("b").expand(),$dhx.ui.mvp.views.get("ip").render($dhx.ui.mvp.views.get("providers").layout_servers.cells("b")),$dhx.ui.mvp.views.get("ip").toolbar.enableItem("create")},toolbar_itemOnClickHandler:function(r){var t=$dhx.ui.mvp.presenters.get(e);t.view;"close"==r&&t.destroy_item()},show_item:function(){var e=this,t=e.view;t.layout.cells("b").progressOn(),e.model.schema.io[r].read({record:{id:t.grid.getSelectedRowId()},onSuccess:function(e){t.layout.cells("b").setText(e.get("name")),$dhx.ui.mvp.ui.isMobile?(t.layout.cells("a").collapse(),t.layout.cells("b").expand()):t.layout.cells("b").expand(),t._toolbar_item(),t._form_item(e),t.toolbar.enableItem("update"),t.toolbar.enableItem("destroy"),t.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,r=e.view;r.layout&&(r.layout.cells("b").collapse(),r.layout.cells("b").setText("Select a Server first")),r.form_item&&(r.form_item.unload(),r.form_item=null)},fill_grid:function(e){var t=this,o=t.view;o.grid.clearAll(),t.model.data[r]().fetch({sort:{index:"provider",order:1},filter:function(e){if(e.provider==t.get_selected_provider())return e},success:function(r,t,i){r.models.forEach(function(e){var r=[];o._settings.grid.id.forEach(function(t){"purchase"==t||"expiration"==t?r.push(new Date(e.get(t))):r.push($dhx.strip_tags(e.get(t)))}),o.grid.addRow(e.get("id"),r)}),o.grid.adjustColumnSize(o.grid.getColIndexById("name")),e&&e()},error:function(e,r,t){}})},selected_server:null,get_selected_provider:function(){return $dhx.ui.mvp.presenters.get("providers").selected_provider},get_selected_server:function(){return $dhx.ui.mvp.presenters.get("servers").selected_server}};return t}()});