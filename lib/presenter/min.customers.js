$dhx.ui.mvp.presenters.declare({customers:function(){"strict";var e="customers",o="customers",t={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var o=this;o.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(t,i){var n=$dhx.ui.mvp.presenters.get(e),r=n.view;if(console.log(e+"Child Presenter Received Message: ",i),i.collection==o)if("create"==i.method){var s=[];r._settings.grid.id.forEach(function(e){s.push(i.model[e])}),console.log(i),r.grid.addRow(i.model.id||i.model._id,s,0)}else if("update"==i.method){if(r._settings.grid.id.forEach(function(e,o){r.grid.cells(i.model.id,r.grid.getColIndexById(e)).setValue(i.model[e])}),r.form_item){setTimeout(function(){n.show_item()},300)}}else"destroy"==i.method&&r.grid.deleteRow(i.model.id)},toolbarOnClickHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,"destroy"!=o?t.mount_form_input_ui(o):"destroy"==o&&(this.disableItem("destroy"),t.delete_item({onSuccess:function(){t.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var t,i=$dhx.ui.mvp.presenters.get(e),n=i.view,r=n.form.getFormData();if(n.form.check()){n.form.lock(),t={};for(var s in r)t[s]=r[s];"update"==n.form.action&&(t.id=n.grid.getSelectedRowId()),t.expiration&&(t.expiration=new Date(t.expiration).getTime()),console.log(t),console.log(n.form.action),i.model.schema.io[o][n.form.action]({record:t,onSuccess:function(){n.form.isItemChecked("close_on_save")?n.window.close():(n.form.reset(),n.form.unlock())},onFail:function(){n.form.unlock()}})}},formOnButtonClickHandler:function(o){"save"==o?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==o&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},fill_ips_grid_form_input_ui:function(o){var t=$dhx.ui.mvp.presenters.get(e),i=t.view;i.grid_ips.clearAll(),i.form.lock(),t.model.schema.io.ips.readAll({filter:function(e){if(e.provider==o)return e},onSuccess:function(e,o,n){e.forEach(function(e){t.isIpAssigned({number:e.get("number"),onSuccess:function(o,t,n,r){var s=[];i._settings.grid_ips.id.forEach(function(o){s.push($dhx.strip_tags(e.get(o)))}),s.push(o),i.grid_ips.addRow(e.get("id"),s)},onFail:function(){}})}),i.grid_ips.adjustColumnSize(i.grid_ips.getColIndexById("number")),i.form.unlock()},onFail:function(){i.form.unlock()}})},isIpAssigned:function(o){var t=$dhx.ui.mvp.presenters.get(e),i=(t.view,o.number||!1),n=o.customerID,r={onSuccess:function(e,t,i){var n=!1;t.length>0,o.onSuccess&&o.onSuccess(n,e,t,i)},onFail:function(){o.onFail&&o.onFail(arguments)}};if(!i)throw"Can not lookup with a number";n&&(r.filter=function(e){if(e.id==n)return e}),t.model.schema.io.customers.readAll(r)},mount_form_input_ui:function(t){var i,n,r=$dhx.ui.mvp.presenters.get(e),s=r.view,d=s._window();s.window.setText(("create"==t?"Add new":"Edit")+" Customer"),s._form(d,t),n=s.form.getCombo("provider"),n.allowFreeText(!1),n.enableAutocomplete(),n.enableFilteringMode(!0),i=s.form.getCombo("type"),i.allowFreeText(!1),i.enableAutocomplete(),i.enableFilteringMode(!0),"create"==t?(s.form.getContainer("assigned_ips").innerHTML="<i>Please save the customer prior to assign IPs</i>",s.form.getContainer("notes").innerHTML="<i>Please save the customer prior to add notes</i>"):(s._grid_ips(),s._grid_notes(),n.attachEvent("onChange",function(e,o){r.fill_ips_grid_form_input_ui(e)})),s.form.lock(),r.model.schema.io.providers.readAll({filter:function(e){if("Active"==e.status)return e},onSuccess:function(e,d,c){n.addOption(d.map(function(e){return[e.id,e.name]})),r.model.schema.io.customer_types.readAll({onSuccess:function(e,n,d){i.addOption(n.map(function(e){return[e.type,e.type]})),"update"==t?r.model.schema.io[o].read({record:{id:s.grid.getSelectedRowId()},onSuccess:function(e){var o=e.toJSON();delete o.id,delete o._id,delete o.__v,o.expiration=new Date(o.expiration),s.form.setFormData(o),s.form.unlock(),s.form.setFocusOnFirstActive()},onFail:function(){}}):(s.form.unlock(),s.form.setFocusOnFirstActive())},onFail:function(){}})},onFail:function(){}})},delete_item:function(t){var i=$dhx.ui.mvp.presenters.get(e);view=i.view,i.model.schema.io[o].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){t.onSuccess&&t.onSuccess()},onFail:function(){t.onFail&&t.onFail()}})},gridOnRowSelectHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,t.show_item()},toolbar_itemOnClickHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);t.view;"close"==o&&t.destroy_item()},show_item:function(){var e=this,t=e.view;t.layout.cells("b").progressOn(),e.model.schema.io[o].read({record:{id:t.grid.getSelectedRowId()},onSuccess:function(e){$dhx.ui.mvp.ui.isMobile?(t.layout.cells("a").collapse(),t.layout.cells("b").expand()):t.layout.cells("b").expand(),t._toolbar_item(),t._form_item(e),t.toolbar.enableItem("update"),t.toolbar.enableItem("destroy"),t.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,o=e.view;o.layout.cells("b").collapse(),o.form_item&&(o.form_item.unload(),o.form_item=null)},fill_grid:function(e){var t=this,i=t.view;t.model.data[o]().fetch({sort:{index:"name",order:1},success:function(o,t,n){o.models.forEach(function(e){var o=[];i._settings.grid.id.forEach(function(t){"expiration"==t?o.push(new Date(e.get(t)).toISOString()):o.push($dhx.strip_tags(e.get(t)))}),i.grid.addRow(e.get("id"),o)}),i.grid.adjustColumnSize(i.grid.getColIndexById("name")),e&&e()},error:function(e,o,t){}})}};return t}()});