$dhx.ui.mvp.presenters.declare({providers:function(){"strict";var e="providers",o="providers",t={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var o=this;o.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(t,i){var r=$dhx.ui.mvp.presenters.get(e),n=r.view;if(console.log(e+"Child Presenter Received Message: ",i),i.collection==o)if("create"==i.method){var s=[];n._settings.grid.id.forEach(function(e){s.push(i.model[e])}),console.log(i),n.grid.addRow(i.model.id||i.model._id,s,0)}else if("update"==i.method){if(n._settings.grid.id.forEach(function(e,o){n.grid.cells(i.model.id,n.grid.getColIndexById(e)).setValue(i.model[e])}),n.form_item){setTimeout(function(){r.show_item()},300)}}else"destroy"==i.method&&n.grid.deleteRow(i.model.id)},toolbarOnClickHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,"destroy"!=o?t.mount_form_input_ui(o):"destroy"==o&&(this.disableItem("destroy"),t.delete_item({onSuccess:function(){t.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var t,i=$dhx.ui.mvp.presenters.get(e),r=i.view,n=r.form.getFormData();if(r.form.check()){r.form.lock(),t={};for(var s in n)t[s]=n[s];"update"==r.form.action&&(t.id=r.grid.getSelectedRowId()),t.expiration&&(t.expiration=new Date(t.expiration).getTime()),t.password&&(t.password=$dhx.crypt.base64_encode(t.password)),console.log(r.form.action),i.model.schema.io[o][r.form.action]({record:t,onSuccess:function(){r.form.isItemChecked("close_on_save")?r.window.close():(r.form.reset(),r.form.unlock())},onFail:function(){r.form.unlock()}})}},formOnButtonClickHandler:function(o){"save"==o?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==o&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},mount_form_input_ui:function(t){var i=$dhx.ui.mvp.presenters.get(e),r=i.view,n=r._window();r.window.setText(("create"==t?"Add new":"Edit")+" question"),r._form(n,t),"update"==t?(r.form.lock(),i.model.schema.io[o].read({record:{id:r.grid.getSelectedRowId()},onSuccess:function(e){var o=e.toJSON();delete o.id,delete o._id,delete o.__v,o.expiration=new Date(o.expiration),o.password&&(o.password=$dhx.crypt.base64_decode(o.password)),r.form.setFormData(o),r.form.unlock(),r.form.setFocusOnFirstActive()},onFail:function(){}})):r.form.setFocusOnFirstActive()},delete_item:function(t){var i=$dhx.ui.mvp.presenters.get(e);view=i.view,i.model.schema.io[o].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){t.onSuccess&&t.onSuccess()},onFail:function(){t.onFail&&t.onFail()}})},gridOnRowSelectHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,t.show_item()},toolbar_itemOnClickHandler:function(o){var t=$dhx.ui.mvp.presenters.get(e);t.view;"close"==o&&t.destroy_item()},show_item:function(){var e=this,t=e.view;t.layout.cells("b").progressOn(),e.model.schema.io[o].read({record:{id:t.grid.getSelectedRowId()},onSuccess:function(e){$dhx.ui.mvp.ui.isMobile?(t.layout.cells("a").collapse(),t.layout.cells("b").expand()):t.layout.cells("b").expand(),t._toolbar_item(),t._form_item(e),t.toolbar.enableItem("update"),t.toolbar.enableItem("destroy"),t.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,o=e.view;o.layout.cells("b").collapse(),o.form_item&&(o.form_item.unload(),o.form_item=null)},fill_grid:function(e){var t=this,i=t.view;t.model.data[o]().fetch({sort:{index:"name",order:1},success:function(o,t,r){o.models.forEach(function(e){var o=[];i._settings.grid.id.forEach(function(t){o.push($dhx.strip_tags(e.get(t)))}),i.grid.addRow(e.get("id"),o)}),i.grid.adjustColumnSize(i.grid.getColIndexById("name")),e&&e()},error:function(e,o,t){}})}};return t}()});