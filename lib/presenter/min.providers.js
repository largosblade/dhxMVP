$dhx.ui.mvp.presenters.declare({providers:function(){"strict";var e="providers",o="providers",r={___aaaa:"provider presenter",start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var o=this;o.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(r,t){var i,s,d=$dhx.ui.mvp.presenters.get(e),n=d.view;if(console.log(e+" Child Presenter Received Message: ",t),t.collection==o)"create"==t.method?(i=[],n._settings.grid.id.forEach(function(e){i.push(t.model[e])}),console.log(t),n.grid.addRow(t.model.id||t.model._id,i,0)):"update"==t.method?(n._settings.grid.id.forEach(function(e,o){n.grid.cells(t.model.id,n.grid.getColIndexById(e)).setValue(t.model[e])}),n.form_item&&(s=setTimeout(function(){d.show_item()},300))):"destroy"==t.method&&n.grid.deleteRow(t.model.id);else if("servers"==t.collection){if(!n.servers)return;"create"==t.method?(i=[],n.servers._settings.grid.id.forEach(function(e){i.push(t.model[e])}),console.log(t),n.servers.grid.addRow(t.model.id||t.model._id,i,0)):"update"==t.method?(n.servers._settings.grid.id.forEach(function(e,o){n.servers.grid.cells(t.model.id,n.grid.getColIndexById(e)).setValue(t.model[e])}),n.servers.form_item&&(s=setTimeout(function(){n.servers.presenter.show_item()},300))):"destroy"==t.method&&n.servers.grid.deleteRow(t.model.id)}else if("ips"==t.collection){if(!n.ips)return;"create"==t.method?(i=[],n.ips._settings.grid.id.forEach(function(e){i.push(t.model[e])}),console.log(t),n.ips.grid.addRow(t.model.id||t.model._id,i,0)):"update"==t.method?(n.ips._settings.grid.id.forEach(function(e,o){console.log(e,n.ips.grid.getColIndexById(e)),n.ips.grid.cells(t.model.id,n.ips.grid.getColIndexById(e)).setValue(t.model[e])}),n.ips.form_item&&(s=setTimeout(function(){n.ips.presenter.show_item()},300))):"destroy"==t.method&&n.ips.grid.deleteRow(t.model.id)}},toolbarOnClickHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,"destroy"!=o?r.mount_form_input_ui(o):"destroy"==o&&(this.disableItem("destroy"),r.delete_item({onSuccess:function(){r.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var r,t=$dhx.ui.mvp.presenters.get(e),i=t.view,s=i.form.getFormData();if(i.form.check()){i.form.lock(),r={};for(var d in s)r[d]=s[d];"update"==i.form.action&&(r.id=i.grid.getSelectedRowId()),r.expiration&&(r.expiration=new Date(r.expiration).getTime()),r.password&&(r.password=$dhx.crypt.base64_encode(r.password)),console.log(i.form.action),t.model.schema.io[o][i.form.action]({record:r,onSuccess:function(){i.form.isItemChecked("close_on_save")?i.window.close():(i.form.reset(),i.form.unlock())},onFail:function(){i.form.unlock()}})}},formOnButtonClickHandler:function(o){"save"==o?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==o&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},mount_form_input_ui:function(r){var t=$dhx.ui.mvp.presenters.get(e),i=t.view,s=i._window();i.window.setText(("create"==r?"Add new":"Edit")+" Provider"),i._form(s,r),"update"==r?(i.form.lock(),t.model.schema.io[o].read({record:{id:i.grid.getSelectedRowId()},onSuccess:function(e){var o=e.toJSON();delete o.id,delete o._id,delete o.__v,o.expiration=new Date(o.expiration),o.password&&(o.password=$dhx.crypt.base64_decode(o.password)),i.form.setFormData(o),i.form.unlock(),i.form.setFocusOnFirstActive()},onFail:function(){}})):i.form.setFocusOnFirstActive()},delete_item:function(r){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,t.model.schema.io[o].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){r.onSuccess&&r.onSuccess()},onFail:function(){r.onFail&&r.onFail()}})},gridOnRowSelectHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,r.selected_provider=o,r.show_item()},toolbar_itemOnClickHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);r.view;"close"==o&&r.destroy_item()},show_item:function(){var e=this,r=e.view;e.destroy_item(),r.layout.cells("b").progressOn(),e.model.schema.io[o].read({record:{id:r.grid.getSelectedRowId()},onSuccess:function(e){$dhx.ui.mvp.ui.isMobile?(r.layout.cells("a").collapse(),r.layout.cells("b").expand()):r.layout.cells("b").expand(),r._accordion(),r._toolbar_item(),r._form_item(e),r._layout_servers(),r.accordion.cells("a").setText(e.get("name")+" - Overall information"),r.accordion.cells("b").setText(e.get("name")+" - Servers information"),$dhx.ui.mvp.views.get("servers").render(r.layout_servers.cells("a")),r.layout_servers.cells("b").collapse(),r.toolbar.enableItem("update"),r.toolbar.enableItem("destroy"),r.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,o=e.view;o.servers.presenter.destroy_item(),o.ips.presenter.destroy_item(),o.layout.cells("b").collapse(),o.form_item&&(o.form_item.unload(),o.form_item=null)},fill_grid:function(e){var r=this,t=r.view;r.model.data[o]().fetch({sort:{index:"name",order:1},success:function(o,r,i){o.models.forEach(function(e){var o=[];t._settings.grid.id.forEach(function(r){"expiration"==r?o.push(new Date(e.get(r)).toISOString()):o.push($dhx.strip_tags(e.get(r)))}),t.grid.addRow(e.get("id"),o)}),t.grid.adjustColumnSize(t.grid.getColIndexById("name")),e&&e()},error:function(e,o,r){}})},selected_provider:null,get_selected_provider:function(){return $dhx.ui.mvp.presenters.get("providers").selected_provider},get_selected_server:function(){return $dhx.ui.mvp.presenters.get("servers").selected_server}};return r}()});