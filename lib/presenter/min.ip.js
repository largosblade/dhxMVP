$dhx.ui.mvp.presenters.declare({ip:function(){"strict";var e="ip",t="ips",o={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var t=this;t.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(o,r){var i=$dhx.ui.mvp.presenters.get(e),n=i.view;if(console.log(e+"Child Presenter Received Message: ",r),r.collection==t)if("create"==r.method){var s=[];n._settings.grid.id.forEach(function(e){s.push(r.model[e])}),console.log(r),n.grid.addRow(r.model.id||r.model._id,s,0)}else if("update"==r.method){if(n._settings.grid.id.forEach(function(e,t){n.grid.cells(r.model.id,n.grid.getColIndexById(e)).setValue(r.model[e])}),n.form_item){setTimeout(function(){i.show_item()},300)}}else"destroy"==r.method&&n.grid.deleteRow(r.model.id);else"providers"==r.collection&&("create"==r.method||"update"==r.method||"destroy"==r.method)},toolbarOnClickHandler:function(t){var o=$dhx.ui.mvp.presenters.get(e);view=o.view,"destroy"!=t?o.mount_form_input_ui(t):"destroy"==t&&(this.disableItem("destroy"),o.delete_item({onSuccess:function(){o.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var o,r=$dhx.ui.mvp.presenters.get(e),i=r.view,n=i.form.getFormData();if(i.form.check()){i.form.lock(),o={};for(var s in n)o[s]=n[s];"update"==i.form.action&&(o.id=i.grid.getSelectedRowId()),o.expiration&&(o.expiration=new Date(o.expiration).getTime()),o.number&&(o.number=o.number.replace(/_/gi,"")),console.log(i.form.action),r.model.schema.io[t][i.form.action]({record:o,onSuccess:function(){i.form.isItemChecked("close_on_save")?i.window.close():(i.form.reset(),i.form.unlock())},onFail:function(){i.form.unlock()}})}},formOnButtonClickHandler:function(t){"save"==t?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==t&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},set_combos_mount_form_input_ui:function(t,o,r){var i=$dhx.ui.mvp.presenters.get(e),n=i.view,s=n.form.getCombo("provider"),d=n.form.getCombo("server"),l=n.form.getCombo("status"),c=n.form.getCombo("assigned_to");s.addOption(t.map(function(e){return[e.id,e.name]})),d.addOption(o.map(function(e){return[e.id,e.name]})),r.push({id:null,name:""}),c.addOption(r.map(function(e){return[e.id,e.name]})),c.attachEvent("onChange",function(e,t){null===e?l.selectOption(l.getIndexByValue("Available"),!0,!0):l.selectOption(l.getIndexByValue("Used"),!0,!0)}),i.get_selected_provider()&&s.selectOption(s.getIndexByValue(i.get_selected_provider()),!0,!0),i.get_selected_server()&&d.selectOption(d.getIndexByValue(i.get_selected_server()),!0,!0),n.form.disableItem("provider"),n.form.disableItem("server"),l.selectOption(l.getIndexByValue("Available"),!0,!0),c.selectOption(c.getIndexByValue(null),!0,!0),n.form.disableItem("assigned_to"),n.form.disableItem("status")},mount_form_input_ui:function(o){var r=$dhx.ui.mvp.presenters.get(e),i=r.view,n=i._window();i.window.setText(("create"==o?"Add new":"Edit")+" IP"),i._form(n,o),i.form.lock(),r.model.schema.io.providers.readAll({onSuccess:function(e,n,s){r.model.schema.io.servers.readAll({filter:function(e){if(e.provider==r.get_selected_provider())return e},onSuccess:function(e,s,d){r.model.schema.io.customers.readAll({onSuccess:function(e,d,l){r.set_combos_mount_form_input_ui(n,s,d),"update"==o?r.model.schema.io[t].read({record:{id:i.grid.getSelectedRowId()},onSuccess:function(e){var t=e.toJSON();delete t.id,delete t._id,delete t.__v,t.number&&(t.number=t.number.replace(/_/gi,"")),i.form.setFormData(t),i.form.unlock(),i.form.setFocusOnFirstActive()},onFail:function(){}}):(i.form.unlock(),i.form.setFocusOnFirstActive())},onFail:function(){}})},onFail:function(){}})},onFail:function(){}})},delete_item:function(o){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,r.model.schema.io[t].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){o.onSuccess&&o.onSuccess()},onFail:function(){o.onFail&&o.onFail()}})},gridOnRowSelectHandler:function(t){var o=$dhx.ui.mvp.presenters.get(e);view=o.view,o.show_item()},toolbar_itemOnClickHandler:function(t){var o=$dhx.ui.mvp.presenters.get(e);o.view;"close"==t&&o.destroy_item()},show_item:function(){var e=this,o=e.view;o.layout.cells("b").progressOn(),e.model.schema.io[t].read({record:{id:o.grid.getSelectedRowId()},onSuccess:function(e){$dhx.ui.mvp.ui.isMobile?(o.layout.cells("a").collapse(),o.layout.cells("b").expand()):o.layout.cells("b").expand(),o._toolbar_item(),o._form_item(e),o.toolbar.enableItem("update"),o.toolbar.enableItem("destroy"),o.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,t=e.view;t.layout&&(t.layout.cells("b").collapse(),t.layout.cells("b").setText("Select a IP first")),t.form_item&&(t.form_item.unload(),t.form_item=null)},fill_grid:function(e){var o=this,r=o.view;r.grid.clearAll(),o.model.data[t]().fetch({sort:{index:"number",order:1},filter:function(e){if(e.server==o.get_selected_server())return e},success:function(t,o,i){t.models.forEach(function(e){var t=[];r._settings.grid.id.forEach(function(o){"assigned_to"==o?t.push(e.get(o)?e.get(o):"null"):t.push($dhx.strip_tags(e.get(o)))}),r.grid.addRow(e.get("id"),t)}),r.grid.adjustColumnSize(r.grid.getColIndexById("assigned_to")),e&&e()},error:function(e,t,o){}})},get_selected_provider:function(){return $dhx.ui.mvp.presenters.get("providers").selected_provider},get_selected_server:function(){return $dhx.ui.mvp.presenters.get("servers").selected_server}};return o}()});