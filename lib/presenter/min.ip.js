$dhx.ui.mvp.presenters.declare({ip:function(){"strict";var e="ip",o="ips",r={start:function(){$dhx.debug.log(e+":PRESENTER: start from presenter defined by user")},destroy:function(){var o=this;o.view;$dhx.debug.log(e+":PRESENTER: destroy from presenter defined by user")},subscriber:function(r,t){var i=$dhx.ui.mvp.presenters.get(e),n=i.view;if(console.log(e+"Child Presenter Received Message: ",t),t.collection==o)if("create"==t.method){var s=[];n._settings.grid.id.forEach(function(e){s.push(t.model[e])}),console.log(t),n.grid.addRow(t.model.id||t.model._id,s,0)}else if("update"==t.method){if(n._settings.grid.id.forEach(function(e,o){n.grid.cells(t.model.id,n.grid.getColIndexById(e)).setValue(t.model[e])}),n.form_item){setTimeout(function(){i.show_item()},300)}}else"destroy"==t.method&&n.grid.deleteRow(t.model.id);else"providers"==t.collection&&("create"==t.method||"update"==t.method||"destroy"==t.method)},toolbarOnClickHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,"destroy"!=o?r.mount_form_input_ui(o):"destroy"==o&&(this.disableItem("destroy"),r.delete_item({onSuccess:function(){r.destroy_item()},onFail:function(){view.form.unlock()}}))},form_process:function(){var r,t=$dhx.ui.mvp.presenters.get(e),i=t.view,n=i.form.getFormData();if(i.form.check()){i.form.lock(),r={};for(var s in n)r[s]=n[s];"update"==i.form.action&&(r.id=i.grid.getSelectedRowId()),r.expiration&&(r.expiration=new Date(r.expiration).getTime()),r.number&&(r.number=r.number.replace(/_/gi,"")),r.password&&(r.password=$dhx.crypt.base64_encode(r.password)),console.log(i.form.action),t.model.schema.io[o][i.form.action]({record:r,onSuccess:function(){i.form.isItemChecked("close_on_save")?i.window.close():(i.form.reset(),i.form.unlock())},onFail:function(){i.form.unlock()}})}},formOnButtonClickHandler:function(o){"save"==o?$dhx.ui.mvp.presenters.get(e).form_process():"reset"==o&&view.form.reset()},formOnEnterHandler:function(){$dhx.ui.mvp.presenters.get(e).form_process()},mount_form_input_ui:function(r){var t=$dhx.ui.mvp.presenters.get(e),i=t.view,n=i._window();i.window.setText(("create"==r?"Add new":"Edit")+" IP"),i._form(n,r),i.form.lock(),t.model.schema.io.providers.readAll({onSuccess:function(e,n,s){t.model.schema.io.servers.readAll({filter:function(e){if(e.provider==t.get_selected_provider())return e},onSuccess:function(e,s,d){var c=i.form.getCombo("provider"),l=i.form.getCombo("server");c.addOption(n.map(function(e){return[e.id,e.name]})),l.addOption(s.map(function(e){return[e.id,e.name]})),t.get_selected_provider()&&c.selectOption(c.getIndexByValue(t.get_selected_provider()),!0,!0),t.get_selected_server()&&l.selectOption(l.getIndexByValue(t.get_selected_server()),!0,!0),i.form.disableItem("provider"),i.form.disableItem("server"),"update"==r?t.model.schema.io[o].read({record:{id:i.grid.getSelectedRowId()},onSuccess:function(e){var o=e.toJSON();delete o.id,delete o._id,delete o.__v,o.number&&(o.number=o.number.replace(/_/gi,"")),i.form.setFormData(o),i.form.unlock(),i.form.setFocusOnFirstActive()},onFail:function(){}}):(i.form.unlock(),i.form.setFocusOnFirstActive())},onFail:function(){}})},onFail:function(){}})},delete_item:function(r){var t=$dhx.ui.mvp.presenters.get(e);view=t.view,t.model.schema.io[o].destroy({record:{id:view.grid.getSelectedRowId()},onSuccess:function(e){r.onSuccess&&r.onSuccess()},onFail:function(){r.onFail&&r.onFail()}})},gridOnRowSelectHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);view=r.view,r.show_item()},toolbar_itemOnClickHandler:function(o){var r=$dhx.ui.mvp.presenters.get(e);r.view;"close"==o&&r.destroy_item()},show_item:function(){var e=this,r=e.view;r.layout.cells("b").progressOn(),e.model.schema.io[o].read({record:{id:r.grid.getSelectedRowId()},onSuccess:function(e){$dhx.ui.mvp.ui.isMobile?(r.layout.cells("a").collapse(),r.layout.cells("b").expand()):r.layout.cells("b").expand(),r._toolbar_item(),r._form_item(e),r.toolbar.enableItem("update"),r.toolbar.enableItem("destroy"),r.layout.cells("b").progressOff()},onFail:function(){}})},destroy_item:function(){var e=this,o=e.view;o.layout&&(o.layout.cells("b").collapse(),o.layout.cells("b").setText("Select a IP first")),o.form_item&&(o.form_item.unload(),o.form_item=null)},fill_grid:function(e){var r=this,t=r.view;t.grid.clearAll(),r.model.data[o]().fetch({sort:{index:"number",order:1},filter:function(e){if(e.server==r.get_selected_server())return e},success:function(o,r,i){o.models.forEach(function(e){var o=[];t._settings.grid.id.forEach(function(r){o.push($dhx.strip_tags(e.get(r)))}),t.grid.addRow(e.get("id"),o)}),t.grid.adjustColumnSize(t.grid.getColIndexById("number")),e&&e()},error:function(e,o,r){}})},get_selected_provider:function(){return $dhx.ui.mvp.presenters.get("providers").selected_provider},get_selected_server:function(){return $dhx.ui.mvp.presenters.get("servers").selected_server}};return r}()});