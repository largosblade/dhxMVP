var model=function(){var e={database:{id:"dhxMVP",description:"dhxMVP demo database",nolog:!0,migrations:[]},versions:{1:{users:{item:"user",defaults:{__v:{type:Number,"default":0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"__v",type:"hidden"},grid:{header:"__v",align:"left",coltype:"ro",width:"0"}}},_id:{type:String,"default":0,unique:!0,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"_id",type:"hidden"},grid:{header:"_id",align:"left",coltype:"ro",width:"0"}}},type:{type:String,"default":"Xpert",unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"User Type",type:"hidden"},grid:{header:"User Type",align:"left",coltype:"ro",width:"0"}}},phone:{type:String,"default":null,unique:!1,validate:{required:!1,mask_to_use:"us_phone",rules:""},ui:{form:{label:"Phone",type:"input"},grid:{header:"Phone",align:"right",coltype:"ro",width:"0"}}},display_name:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:"NotEmpty"},ui:{form:{label:"Display name",type:"input"},grid:{header:"Display name",align:"left",coltype:"ro",width:"0"}}},first_name:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:"NotEmpty"},ui:{form:{label:"First name",type:"input"},grid:{header:"First name",align:"left",coltype:"ro",width:"120"}}},last_name:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Last name",type:"input"},grid:{header:"Last name",align:"left",coltype:"ro",width:"120"}}},bio:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Bio",type:"input",rows:6},grid:{header:"Bio",align:"left",coltype:"ro",width:"120"}}},title:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Title",type:"input"},grid:{header:"Title",align:"",coltype:"ro",width:""}}},organizations:{type:[],"default":[],unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Organizations",type:"template"},grid:{header:"Organizations",align:"left",coltype:"ro",width:"0"}}},picture:{type:String,"default":null,unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Picture",type:"container"},grid:{header:"Picture",align:"left",coltype:"ro",width:"0"}}},rate:{type:Number,"default":150,unique:!1,validate:{required:!0,mask_to_use:"currency",rules:""},ui:{form:{label:"Rate",type:"input"},grid:{header:"Rate",align:"left",coltype:"ro",width:"100"}}},primary_skills:{type:[],"default":[],unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Primary skills",type:"hidden"},grid:{header:"Primary skills",align:"left",coltype:"ro",width:"0"}}},additional_skills:{type:[],"default":[],unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Additional skills",type:"hidden"},grid:{header:"Additional skills",align:"left",coltype:"ro",width:"0"}}},invites:{type:[],"default":[],unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Invites",type:"hidden"},grid:{header:"Invites",align:"left",coltype:"ro",width:"0"}}},other_skills:{type:String,"default":null,unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Other skills",type:"hidden"},grid:{header:"Other skills",align:"left",coltype:"ro",width:"0"}}},availability:{type:Number,"default":30,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Availbility",type:"hidden"},grid:{header:"Availbility",align:"right",coltype:"ro",width:"0"}}},city:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"City",type:"input"},grid:{header:"City",align:"left",coltype:"ro",width:"0"}}},state:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"State",type:"input"},grid:{header:"State",align:"left",coltype:"ro",width:"0"}}},country:{type:String,"default":"USA",unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Country",type:"input"},grid:{header:"Country",align:"left",coltype:"ro",width:"0"}}},experience:{type:Number,"default":0,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:""},ui:{form:{label:"Experience",type:"input"},grid:{header:"Experience",align:"right",coltype:"ro",width:"0"}}},username:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:void 0,rules:"NotEmpty"},ui:{form:{label:"Username",type:"input"},grid:{header:"Username",align:"left",coltype:"ro",width:"120"}}},resume:{type:String,"default":null,unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Resume",type:"hidden"},grid:{header:"Resume",align:"left",coltype:"ro",width:"0"}}},certifications:{type:String,"default":null,unique:!1,validate:{required:!1,mask_to_use:void 0,rules:""},ui:{form:{label:"Certifications",type:"hidden"},grid:{header:"Certifications",align:"left",coltype:"ro",width:"0"}}},default_org:{type:String,"default":null,unique:!1,validate:{required:!0,mask_to_use:"",rules:"NotEmpty"},ui:{form:{label:"Default Organization",type:"combo"},grid:{header:"Default Organization",align:"left",coltype:"coro",width:"150"}}},IS_Client:{type:Boolean,"default":!1,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"Client",type:"btn2state"},grid:{header:"Client",align:"center",coltype:"acheck",width:"70"}}},IS_PM:{type:Boolean,"default":!1,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"Project Manager",type:"btn2state"},grid:{header:"Project Manager",align:"center",coltype:"acheck",width:"70"}}},IS_Xpert:{type:Boolean,"default":!0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"Xpert",type:"btn2state"},grid:{header:"Xpert",align:"center",coltype:"acheck",width:"70"}}},MC_ADMIN:{type:Boolean,"default":!0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"MindCrowd Admin.",type:"btn2state"},grid:{header:"MindCrowd Admin.",align:"center",coltype:"acheck",width:"70"}}}}}}}},t={database:e.database,versions:e.versions};return t}();model.data=function(){var e={},t={},i={_collections:e,start:function(){var d=function(){};for(var r in e)t[e[r].item]=Backbone.Model.extend({database:model.database,storeName:r,nolog:!0,defaults:e[r].defaults,initialize:d}),t[r]=Backbone.Collection.extend({model:t[e[r].item],database:model.database,nolog:!0,storeName:r}),i[e[r].item]=function(i){return function(d){return $dhx.debug.log(i),$dhx.debug.log(e[i].item),new t[e[i].item](d)}}(r),i[r]=function(i){return $dhx.debug.log(i),function(){return $dhx.debug.log(i),$dhx.debug.log(e[i].item),new t[i]}}(r);$dhx.debug.log(i)}};return i}(),model.schema=function(){var e={setup:function(t){var i,d=e,r=null,l=function(){for(r in model.versions){var e=Object.keys(model.versions[r]);e.forEach(function(e){$dhx.debug.log("store name: ",e);var t=model.versions[r][e],i={};for(var d in t.defaults){var l=t.defaults[d];i[d]=l["default"]}model.data._collections[e]={item:t.item,defaults:i}}),i={version:parseInt(r),migrate:function(e,t){var i=[],d=Object.keys(model.versions[r]),l=d.length,a=0;$dhx.debug.log("store_names: ",d),d.forEach(function(t){var d=model.versions[r][t];i[t]=null,e.db.objectStoreNames.contains(t)||(i[t]=e.db.createObjectStore(t)),i[t]=e.objectStore(t);for(var o in d.defaults){var n=d.defaults[o];i[t].createIndex(o,o,{unique:n.unique||!1})}e.addEventListener("complete",function(e){a+=1,$dhx.debug.log(a,l),a==l&&$dhx.debug.log(window.model.data._collections)}),e.onsuccess=function(e){$dhx.debug.log(e)},e.addEventListener("success",function(e){$dhx.debug.log(e)})}),t()}},model.database.migrations.push(i)}d.create_database(t,model)};try{var a=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,o=a.deleteDatabase(model.database.id);o.onsuccess=function(e){$dhx.debug.log("indexedDB: "+model.database.id+" deleted"),l()},o.onerror=function(e){$dhx.debug.error("indexedDB.delete Error: "+e.message),l()}}catch(n){$dhx.debug.error("Error: "+n.message),l()}},get_collection_meta:function(e,t){var i=Object.keys(model.versions[e]),d=!1;return i.forEach(function(i){i==t&&($dhx.debug.log("store name: ",i),d=model.versions[e][i])}),d},get_collection_item:function(e,t){var i=Object.keys(model.versions[e]),d=!1;return $dhx.debug.log("model.versions: ",model.versions),$dhx.debug.log("version: ",e),$dhx.debug.log("model.versions[ version ]: ",model.versions[e]),i.forEach(function(i){i==t&&($dhx.debug.log(i,t),d=model.versions[e][i].item)}),d},create_database:function(t,i){var d=e,r=Object.keys(initial_data),l=(r.length,[]),a=[],o=[],n=[],u=null,s=function(e,t,i){var r=i.shift();collection_name=t.shift(),t.length>0&&i.length>0?($dhx.debug.log("XXXXXXXXXX> "+r,collection_name),d.insert_records_into_table(l[r],collection_name,function(d,r){s(e,t,i)})):e&&e()};$dhx.debug.log(r),r.forEach(function(e,t){u=i.schema.get_collection_item(1,e),l[u]=Backbone.Model.extend({database:i.database,storeName:e}),a[e]=Backbone.Collection.extend({database:i.database,storeName:e,model:l[u]}),o.push(e),n.push(u),$dhx.debug.log("--"),$dhx.debug.log("item: ",u),$dhx.debug.log("collection: ",e),$dhx.debug.log("models[ item ]: ",l[u]),$dhx.debug.log("collections[ collection ]: ",a[e]),$dhx.debug.log("c_names: ",o),$dhx.debug.log("m_names: ",n)}),s(function(){t.onSetup&&t.onSetup()},o,n)},insert_records_into_table:function(t,i,d){var r=e,l=initial_data[i].shift();if($dhx.debug.warn(" ---------------- "),$dhx.debug.log("adding records to: ",i),l){$dhx.debug.log(l),$dhx.debug.log("adding records to: ",i);var a=new t;$dhx.debug.log("record: ",l),$dhx.debug.log("model: ",a),a.save(l,{success:function(){$dhx.debug.info("success inserting record: ",l),$dhx.debug.warn("props: ",Object.keys(l).length),$dhx.debug.log(arguments),r.insert_records_into_table(t,i,d)},error:function(e,t){console.error(t.srcElement.error.message),console.error("error inserting record: ",l),$dhx.debug.warn("props: ",Object.keys(l).length),$dhx.debug.log(e,t)}})}else $dhx.debug.log("done inserting records into: ",i),$dhx.debug.warn(" ---------------- "),d(t,i)},start:function(t){var i=e;t.onSetup=function(){try{$dhx.debug.log("model.schema setup is done!"),model.data.start(),$dhx.debug.log(model.data._collections),$dhx.debug.log(model.data);var e="skills";$dhx.debug.log("name ",e),$dhx.debug.log(model.data[e]()),model.data[e]().fetch({success:function(e,i,d){$dhx.debug.log(e),t.onSuccess&&t.onSuccess(),$dhx.debug.log(e.models)},error:function(e,t,i){$dhx.debug.log(e)}})}catch(i){$dhx.debug.log(i.stack)}},i.setup(t)},io:{user:{update:function(e){var t="string"==typeof e.record?JSON.parse(e.record):e.record,i=new model.data.user({id:t._id});i.save(t,{success:function(){e.onSuccess&&e.onSuccess()},error:function(t,i){dhtmlx.alert({text:"Error saving user data",type:"alert-error"}),e.onFail&&e.onFail()}})}}}};return API={start:e.start,skills:function(){return e.skills},get_collection_meta:e.get_collection_meta,get_collection_item:e.get_collection_item,io:e.io},API}();