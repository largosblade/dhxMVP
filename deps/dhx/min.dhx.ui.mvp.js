!function(e){"use strict"}(window.$dhx=window.$dhx||{}),function(e){"use strict"}($dhx.ui=$dhx.ui||{}),function(e){"use strict";var t,r,n,i,o=[],s=[],d=[],p={},a=function(n){"undefined"==typeof n.appId&&(n.appId=""+Math.random()),this.appId=n.appId,this.container=n.container,this.root=n.root,this.icons_path=n.icons_path||n.root+"assets/icons/64/",this.deps_path=n.deps_path||n.root+"deps/",this.lib_path=n.lib_path||n.root+"lib/",this.stash=n,t=n.root,p=n,p.from="super";var i=e.triggerMethod("before:start",p);if(!i)throw" application will not initialize due a onBeforeStart event returning false";this.initialize(p),this.active_route=!1,this.last_active_route=!1,r=this},u=function(e){n=this},h=function(t){h=e.copyTo(h,t),this.appId=r.appId,this.container=r.container,this.root=r.root,this.icons_path=r.icons_path,this.dispatch=function(e){n.dispatch(e,!0),this.onDispatch&&this.onDispatch(e)},i=this},c=function(t){c=e.copyTo(c,t),this.appId=r.appId,this.container=r.container,this.root=r.root,this.icons_path=r.icons_path},l=function(e){return e.topic=r.appId+".presenter",e._view.topic=r.appId+".view",e._model.topic=r.appId+".model",e._subscriber=e._subscriber||function(t,r){t==e._view.topic||t==e._model.topic},e._subscriber_view_token=$dhx.MQ.subscribe(e._view.topic,e._subscriber),e._subscriber_model_token=$dhx.MQ.subscribe(e._model.topic,e._subscriber),e._view._subscriber=e._view._subscriber||function(e,t){},e._view._subscriber_presenter_token=$dhx.MQ.subscribe(e.topic,e._view._subscriber),e._model._subscriber=e._model._subscriber||function(e,t){},e._model._subscriber_presenter_token=$dhx.MQ.subscribe(e.topic,e._model._subscriber),e};a.prototype={initialize:function(e){},start:function(t){var n=(window.location.hash,[]),i=[],o=[],s=[];t=t||{},i.push(r.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+"presenter.js"),i.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+"view.js"),n.push("http://cdn.dhtmlx.com/edge/dhtmlx.css"),n.push("http://cdn.dhtmlx.com/edge/dhtmlx.js"),n.push(r.deps_path+"thirdparty/signals.js"),n.push(r.deps_path+"thirdparty/hasher.js"),n.push(r.deps_path+"thirdparty/crossroads.js"),n.push(r.deps_path+"dhx/min.dhx.MQ.js"),n.push(r.deps_path+"dhx/dhx.ui.router.js"),t.full?(n.push(r.deps_path+"thirdparty/jquery.min.js"),n.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),n.push(r.deps_path+"dhx/min.dhx.ui.i18n.js"),n.push(r.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),n.push(r.deps_path+"thirdparty/moment.min.js"),n.push(r.deps_path+"thirdparty/moment-timezone-with-data.min.js"),n.push(r.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),n.push(r.deps_path+"dhx/min.dhx.excells.js"),n.push(r.deps_path+"dhx/min.dhx.crypt.js"),n.push(r.deps_path+"thirdparty/ie10-viewport-bug-workaround.js"),n.push(r.deps_path+"thirdparty/min.underscore.js"),n.push(r.deps_path+"thirdparty/backbone-min.js"),n.push(r.deps_path+"thirdparty/min.backbone-indexeddb.js"),n.push(r.deps_path+"dhx/min.dhx.component.js"),n.push(r.deps_path+"dhx/min.dhx.dhtmlx.js"),n.push(r.deps_path+"dhx/min.dhx.ui.form.js")):(t.stripe&&n.push("https://js.stripe.com/v2/"),t.pouch&&n.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),t.backboneIDB&&(n.push(r.deps_path+"thirdparty/min.underscore.js"),n.push(r.deps_path+"thirdparty/backbone-min.js"),n.push(r.deps_path+"thirdparty/min.backbone-indexeddb.js")),t.$dhx_crypt&&n.push(r.deps_path+"dhx/min.dhx.crypt.js"),(t.$dhx_grid||t.$dhx_form)&&(n.push(r.deps_path+"thirdparty/jquery.min.js"),n.push(r.deps_path+"dhx/min.dhx.ui.i18n.js"),n.push(r.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),n.push(r.deps_path+"thirdparty/moment.min.js"),n.push(r.deps_path+"thirdparty/moment-timezone-with-data.min.js"),n.push(r.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),n.push(r.deps_path+"dhx/min.dhx.component.js"),n.push(r.deps_path+"thirdparty/creditcard.min.js")),t.$dhx_grid&&n.push(r.deps_path+"dhx/min.dhx.excells.js"),t.$dhx_form&&(n.push(r.deps_path+"dhx/min.dhx.dhtmlx.js"),n.push(r.deps_path+"dhx/min.dhx.ui.form.js"))),r.stash.model.models&&r.stash.model.models.forEach(function(e){o.push(r.lib_path+"model/models/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),r.stash.model.collections&&r.stash.model.collections.forEach(function(e){o.push(r.lib_path+"model/collections/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),r.stash.model.engine?s=[r.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+r.stash.model.engine+".js"]:(r.stash.model.engine="backboneIDB",s=[r.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+r.stash.model.engine+".js"]),$dhx.onDemand.require(n,function(){$dhx.onDemand.require(o,function(){$dhx.onDemand.require(s,function(){$dhx.onDemand.require(i,function(){e.start_all()})})})})}},u.prototype={dispatch:function(e,t){this.router;"#"!=e?($dhx.ui.router.routeTo(e),$dhx.ui.router.router.resetState()):(window.location.hash="/",r.active_route=e)},route:function(e){this.routes[e.url]=e}},h.prototype={initialize:function(e){}},c.prototype={initialize:function(e){}},e.router={extend:function(t){var r=function(){console.log("start from extend factory")};return e.extend({base:u,factory:t,onBeforeExtend:function(e){e=e||{},e.presenter=e.presenter||{start:r},e.presenter.start=e.presenter.start||r,e.routes=e.routes||{},e.routes.hasOwnProperty("#")||(e.routes["#"]={url:"#",method:"start"})}})}},e.application={extend:function(t){return e.extend({base:a,factory:t,onBeforeExtend:function(){}})}},e.main_view={extend:function(t){return e.extend({base:h,factory:t,onBeforeExtend:function(){}})}},e.child_view={extend:function(t){return e.extend({base:c,factory:t,onBeforeExtend:function(){}})}},e.start_all=function(){e.setup_routes(),e.setup_models(),e.setup_collections(),e.start_model()},e.setup_routes=function(){var e=function(e){};console.log(n.routes);for(var t in n.routes)"#"!=t&&(console.info("Route setup: ",t),$dhx.ui.router.addRoute(t,e))},e.start_model=function(){var t=$dhx.ui.mvp.presenters.get("presenter"),i=$dhx.ui.mvp.views.get("view"),o=$dhx.ui.mvp.model.engine.get(r.stash.model.engine);o.start({onSuccess:function(){console.info("model started"),o.schema.start({onSuccess:function(){i.model=o,i.rendered=!1,i.initialize(),t._view=i,t.view=i,t._model=o,t.model=o,t=l(t),r.presenters=$dhx.ui.mvp.presenters,r.views=$dhx.ui.mvp.views,n.presenter=t,i._router=n,i.presenter=t,r.main_presenter=t,r.main_view=i,e.app_started||e.start_app()}})}})},e.setup_models=function(){r.stash.model.models.forEach(function(e){var t={};t[e]=function(e){"strict";return e}(window[e]),$dhx.ui.mvp.model.declare(t)})},e.setup_collections=function(){r.stash.model.collections.forEach(function(e){var t={};t[e]=function(e){"strict";return e.defaults=$dhx.ui.mvp.model.get(e.model),e.item=e.model,e}(window[e]),$dhx.ui.mvp.model.collection.declare(t)})},e.queryString=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=r.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},e.app_started=!1,e.start_app=function(){var t=$dhx.ui.router.request_url||"";"#/"==t&&(t=""),""!==t&&(t=t.toString().replace(/#/,"")),n.dispatch("#"),$dhx.ui.mvp.presenters.get("presenter").start(),e.triggerMethod("start",p),$dhx.ui.i18n&&$dhx.ui.i18n.start(),$dhx.excells&&$dhx.excells.init(),""!==t?n.presenter._view.render({onSuccess:function(r){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),r.onComplete&&r.onComplete(t)},ok:function(r){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),r.onComplete&&r.onComplete(t)},onFail:function(){}}):n.presenter._view.render({onSuccess:function(){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0},ok:function(){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0},onFail:function(){}}),$dhx.MQ.publish(n.presenter.topic,{action:"start",target:null}),e.app_started=!0},e.extend=function(t){var r=t.base,n=t.factory,i=null;return t.onBeforeExtend&&t.onBeforeExtend(n),i=function(e){e=e||{},r.call(this,e)},i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i=e.copyTo(i,n),i.on=function(e,t){d.push({pattern:e,fn:t,base:r})},i.start=function(e){p=e},i},e.copyTo=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e.prototype[r]=t[r]);return e},e.triggerMethod=function(){var e=arguments[0],t=arguments[1]||!1,r=[];return d.forEach(function(n){n.pattern===e&&(t?r.push(n.fn(t)):r.push(n.fn()))}),!(r.join(".").indexOf("false")>-1)},e.loadModule=function(e,t){var d="start",p=n,a=p.routes,u=null,h=!1,c=eval,_=c(t.route._matchRegexp);for(var m in p.routes)_.test(m)&&(h=!0);if(!h)throw"Undeclared "+e+" route";if(u=t.route._pattern,!(u in p.routes))throw"Undeclared "+u+" route";if(p.routes[u].method&&(d=p.routes[u].method),r.active_route&&"#"!=r.active_route&&r.active_route!=u&&(r.last_active_route=r.active_route,s[r.last_active_route].destroy(),o[r.last_active_route].destroy(),$dhx.MQ.unsubscribe(o[r.last_active_route]._subscriber_presenter_token),$dhx.MQ.unsubscribe(s[r.last_active_route]._subscriber_model_token),$dhx.MQ.unsubscribe(s[r.last_active_route]._subscriber_view_token),o[r.last_active_route]=null,s[r.last_active_route]=null,delete o[r.last_active_route],delete s[r.last_active_route]),r.active_route=u,"#"!=u&&(a[u].presenter=a[u].presenter||u,a[u].view=a[u].view||u),a[u].presenter){var v=[];a[u].view&&v.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+a[u].view+".js"),v.push(r.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+a[u].presenter+".js"),a[u].append_views&&a[u].append_views.forEach(function(e){v.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+e[Object.keys(e)[0]]+".js")}),$dhx.onDemand.load(v,function(){s[u]=$dhx.ui.mvp.presenters.get(a[u].presenter),o[u]=$dhx.ui.mvp.views.get(a[u].view),a[u].append_views&&a[u].append_views.forEach(function(e){o[u][Object.keys(e)[0]]=window[e[Object.keys(e)[0]]]}),s[u]._view=o[u],s[u]._view._wrapper=i._wrapper,s[u]._view.app={mainView:$dhx.ui.mvp.views.get("view"),_child_presenters:s,_child_views:o},s[u]._view.window_manager=i.window_manager,s[u].model=n.presenter._model,s[u].view=o[u],s[u]._model||(s[u]._model=n.presenter._model),s[u]=l(s[u]),o[u].model=n.presenter._model,o[u].presenter=s[u],s[u].start(),o[u].initialize(),o[u].render(n.presenter._model,s[u]),$dhx.MQ.publish(s[u].topic,{action:"start",target:null})})}},e.views={views:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.views.views[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.views.views[t]||!1}},e.presenters={presenters:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.presenters.presenters[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.presenters.presenters[t]||!1}},e.models={models:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.models.models[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.models.models[t]||!1}},e.model={_collections:{},collection:{declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._collections[r]=t[r]},get:function(t){return t=t||!1,t?(t=t.toString().replace(/\//g,""),e.model._collections[t]||!1):e.model._collections}},_engines:{},engine:{declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._engines[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.model._engines[t]||!1}},_models:{},declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._models[r]=t[r]},get:function(t){return t?(t=t.toString().replace(/\//g,""),e.model._models[t]||!1):e.model._models},helpers:{schema:{record:function(t){var r=this,n={},i=["_id","id","__v"],o=e.model.get(t.model);t.record=JSON.parse(JSON.stringify(t.record));for(var s in t.record)i.contains(s)||s in o&&(n[s]=t.record[s]);for(var d in o)if(!i.contains(d))if("undefined"!=typeof n[d]){if(typeof n[d]!==o[d].type.toLowerCase())throw console.warn("error creating record object"),"Invalid type for "+d+". It should be "+o[d].type.toLowerCase()+", but you passed "+typeof n[d];if((o[d].validate.required||(o[d].validate.rules||"").indexOf("NotEmpty")>-1)&&(""===n[d]||null===n[d]))throw console.warn("error creating record object"),"You need to provide a value for "+d+". It should be "+o[d].type.toLowerCase()+"."}else console.info("setting default value ("+o[d]["default"]+") for "+d),n[d]=o[d]["default"];t.record.__v&&(n.__v=t.record.__v),t.record.id&&(n.id=t.record.id),t.record._id&&(n._id=t.record._id);for(var p in n)r[p]=n[p]},defaults:{__v:{type:"number","default":0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"__v",type:"hidden"},grid:{header:"__v",align:"left",coltype:"ro",width:"0"}}},_id:{type:"string","default":0,unique:!0,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"_id",type:"hidden"},grid:{header:"_id",align:"left",coltype:"ro",width:"0"}}}}}}}}($dhx.ui.mvp=$dhx.ui.mvp||{});