!function(e){"use strict"}(window.$dhx=window.$dhx||{}),function(e){"use strict"}($dhx.ui=$dhx.ui||{}),function(e){"use strict";var t,n,i,r,o=[],s=[],d=[],a={},p=function(i){"undefined"==typeof i.appId&&(i.appId=""+Math.random()),this.appId=i.appId,this.container=i.container,this.root=i.root,this.icons_path=i.icons_path||i.root+"assets/icons/64/",this.deps_path=i.deps_path||i.root+"deps/",this.lib_path=i.lib_path||i.root+"lib/",this.stash=i,t=i.root,a=i,a.from="super";var r=e.triggerMethod("before:start",a);if(!r)throw" application will not initialize due a onBeforeStart event returning false";this.initialize(a),this.active_route=!1,this.last_active_route=!1,n=this},u=function(e){i=this},h=function(t){h=e.copyTo(h,t),this.appId=n.appId,this.container=n.container,this.root=n.root,this.icons_path=n.icons_path,this.dispatch=function(e){i.dispatch(e,!0),this.onDispatch&&this.onDispatch(e)},r=this};p.prototype={initialize:function(e){},start:function(t){var i=(window.location.hash,[]),r=[],o=[],s=[];t=t||{},window.screen.availWidth<1024&&(e.ui.isMobile=!0),r.push(n.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+"presenter.js"),r.push(n.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+"view.js"),i.push(n.deps_path+"thirdparty/dhtmlx5.0/dhtmlx.css"),i.push(n.deps_path+"thirdparty/dhtmlx5.0/dhtmlx_.js"),i.push(n.deps_path+"thirdparty/signals.js"),i.push(n.deps_path+"thirdparty/hasher.js"),i.push(n.deps_path+"thirdparty/crossroads.js"),i.push(n.deps_path+"dhx/min.dhx.MQ.js"),i.push(n.deps_path+"dhx/dhx.ui.Mediator.js"),i.push(n.deps_path+"dhx/dhx.ui.router.js"),i.push(n.deps_path+"dhx/dhx.ui.session.js"),i.push(n.deps_path+"dhx/min.dhx.ui.data.js"),t.full?(i.push(n.deps_path+"thirdparty/jquery.min.js"),i.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),i.push(n.deps_path+"dhx/min.dhx.ui.i18n.js"),i.push(n.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),i.push(n.deps_path+"thirdparty/moment.min.js"),i.push(n.deps_path+"thirdparty/moment-timezone-with-data.min.js"),i.push(n.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),i.push(n.deps_path+"dhx/min.dhx.excells.js"),i.push(n.deps_path+"dhx/min.dhx.crypt.js"),i.push(n.deps_path+"thirdparty/ie10-viewport-bug-workaround.js"),i.push(n.deps_path+"thirdparty/min.underscore.js"),i.push(n.deps_path+"thirdparty/backbone-min.js"),i.push(n.deps_path+"thirdparty/min.backbone-indexeddb.js"),i.push(n.deps_path+"dhx/min.dhx.component.js"),i.push(n.deps_path+"dhx/min.dhx.dhtmlx.js"),i.push(n.deps_path+"dhx/min.dhx.ui.form.js")):(t.stripe&&i.push("https://js.stripe.com/v2/"),t.pouch&&i.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),t.backboneIDB&&(i.push("https://cdn.pubnub.com/pubnub.min.js"),i.push(n.deps_path+"thirdparty/min.underscore.js"),i.push(n.deps_path+"thirdparty/backbone-min.js"),i.push(n.deps_path+"thirdparty/min.backbone-indexeddb.js")),t.$dhx_crypt&&i.push(n.deps_path+"dhx/min.dhx.crypt.js"),(t.$dhx_grid||t.$dhx_form)&&(i.push(n.deps_path+"thirdparty/jquery.min.js"),i.push(n.deps_path+"dhx/min.dhx.ui.i18n.js"),i.push(n.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),i.push(n.deps_path+"thirdparty/moment.min.js"),i.push(n.deps_path+"thirdparty/moment-timezone-with-data.min.js"),i.push(n.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),i.push(n.deps_path+"dhx/min.dhx.component.js"),i.push(n.deps_path+"thirdparty/creditcard.min.js")),t.$dhx_grid&&i.push(n.deps_path+"dhx/min.dhx.excells.js"),t.$dhx_form&&(i.push(n.deps_path+"dhx/min.dhx.dhtmlx.js"),i.push(n.deps_path+"dhx/min.dhx.ui.form.js")),i.push(n.deps_path+"thirdparty/inputmask/jquery.inputmask.bundle.min.js"),i.push(n.deps_path+"thirdparty/inputmask/extra/phone.js")),n.stash.model.models&&n.stash.model.models.forEach(function(e){o.push(n.lib_path+"model/models/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),n.stash.model.collections&&n.stash.model.collections.forEach(function(e){o.push(n.lib_path+"model/collections/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),n.stash.model.engine?s=[n.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+n.stash.model.engine+".js"]:(n.stash.model.engine="backboneIDB",s=[n.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+n.stash.model.engine+".js"]),$dhx.onDemand.require(i,function(){$dhx.onDemand.require(o,function(){$dhx.onDemand.require(s,function(){$dhx.onDemand.require(r,function(){e.start_all()})})})})}},u.prototype={dispatch:function(t,i){this.router;e.destroy_active_route(),"#"!=t?($dhx.ui.router.routeTo(t),$dhx.ui.router.router.resetState()):(window.location.hash="/",n.active_route=t)},route:function(e){this.routes[e.url]=e}},h.prototype={initialize:function(e){}},e.router={extend:function(t){var n=function(){console.log("start from extend factory")};return e.extend({base:u,factory:t,onBeforeExtend:function(e){e=e||{},e.presenter=e.presenter||{start:n},e.presenter.start=e.presenter.start||n,e.routes=e.routes||{},e.routes.hasOwnProperty("#")||(e.routes["#"]={url:"#",method:"start"})}})}},e.application={extend:function(t){return e.extend({base:p,factory:t,onBeforeExtend:function(){}})}},e.main_view={extend:function(t){return e.extend({base:h,factory:t,onBeforeExtend:function(){}})}},e.child_view={extend:function(t){var i=function(t){i=e.copyTo(i,t),this.appId=n.appId,this.container=n.container,this.root=n.root,this.icons_path=n.icons_path};return i.prototype={initialize:function(e){}},e.extend({base:i,factory:t,onBeforeExtend:function(){}})}},e.start_all=function(){window.pubnub=PUBNUB.init({publish_key:"pub-c-d128f7d4-39ab-43e7-9547-4dc1bdea2300",subscribe_key:"sub-c-142379cc-668e-11e6-9eba-02ee2ddab7fe",error:function(e){console.log("Error:",e)},ssl:"https:"==document.location.protocol}),e.setup_routes(),e.setup_models(),e.setup_collections(),e.start_model()},e.setup_routes=function(){var e=function(e){};for(var t in i.routes)"#"!=t&&(console.info("Route setup: ",t),$dhx.ui.router.addRoute(t,e))},e.start_model=function(){var t=$dhx.ui.mvp.presenters.get("presenter"),r=$dhx.ui.mvp.views.get("view"),o=$dhx.ui.mvp.model.engine.get(n.stash.model.engine);o.start({onSuccess:function(){console.info("model started"),o.schema.start({onSuccess:function(){r.model=o,r.rendered=!1,r.initialize(),t._view=r,t.view=r,t.model=o,t._subscriber=t.subscriber||function(e,t){console.log("Presenter subescriber defined in $dhx.ui.mvp Received Message: ",t)},t.model._subscriber=t.model.subscriber||function(e,t){console.log("Model subescriber defined in $dhx.ui.mvp Received Message: ",t)},t._subscriber_token=$dhx.ui.Mediator.listen(Object.keys(o.schema.io).join()+":changeModel",t._subscriber),t.model._subscriber_presenter_token=$dhx.ui.Mediator.listen(Object.keys(o.schema.io).join()+":changeModel",t.model._subscriber),n.presenters=$dhx.ui.mvp.presenters,n.views=$dhx.ui.mvp.views,i.presenter=t,r._router=i,r.presenter=t,n.main_presenter=t,n.main_view=r,e.app_started||e.start_app()}})}})},e.setup_models=function(){n.stash.model.models.forEach(function(e){var t={};t[e]=function(e){"strict";return e}(window[e]),$dhx.ui.mvp.model.declare(t),window[e]=null})},e.setup_collections=function(){n.stash.model.collections.forEach(function(e){var t={};t[e]=function(e){"strict";return e.defaults=$dhx.ui.mvp.model.get(e.model),e.item=e.model,e}(window[e]),$dhx.ui.mvp.model.collection.declare(t),window[e]=null})},e.queryString=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=n.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},e.app_started=!1,e.start_app=function(){var t=$dhx.ui.router.request_url||"";"#/"==t&&(t=""),""!==t&&(t=t.toString().replace(/#/,"")),i.dispatch("#"),$dhx.ui.mvp.presenters.get("presenter").start(),e.triggerMethod("start",a),$dhx.ui.i18n&&$dhx.ui.i18n.start(),$dhx.excells&&$dhx.excells.init(),""!==t?i.presenter._view.render({onSuccess:function(n){e.triggerMethod("render",a),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),n.onComplete&&n.onComplete(t)},ok:function(n){e.triggerMethod("render",a),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),n.onComplete&&n.onComplete(t)},onFail:function(){}}):i.presenter._view.render({onSuccess:function(){e.triggerMethod("render",a),$dhx.ui.mvp.views.get("view").rendered=!0},ok:function(){e.triggerMethod("render",a),$dhx.ui.mvp.views.get("view").rendered=!0},onFail:function(){}}),$dhx.MQ.publish(i.presenter.topic,{action:"start",target:null}),e.app_started=!0},e.extend=function(t){var n=t.base,i=t.factory,r=null;return t.onBeforeExtend&&t.onBeforeExtend(i),r=function(e){e=e||{},n.call(this,e)},r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r=e.copyTo(r,i),r.on=function(e,t){d.push({pattern:e,fn:t,base:n})},r.start=function(e){a=e},r},e.copyTo=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.prototype[n]=t[n]);return e},e.triggerMethod=function(){var e=arguments[0],t=arguments[1]||!1,n=[];return d.forEach(function(i){i.pattern===e&&(t?n.push(i.fn(t)):n.push(i.fn()))}),!(n.join(".").indexOf("false")>-1)},e.loadModule=function(e,t){var d="start",a=i,p=a.routes,u=null,h=!1,c=eval,l=c(t.route._matchRegexp);for(var m in a.routes)l.test(m)&&(h=!0);if(!h)throw"Undeclared "+e+" route";if(u=t.route._pattern,!(u in a.routes))throw"Undeclared "+u+" route";if(a.routes[u].method&&(d=a.routes[u].method),n.active_route=u,"#"!=u&&(p[u].presenter=p[u].presenter||u,p[u].view=p[u].view||u),p[u].presenter){var _=[];p[u].view&&_.push(n.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+p[u].view+".js"),_.push(n.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+p[u].presenter+".js"),$dhx.onDemand.load(_,function(){s[u]=$dhx.ui.mvp.presenters.get(p[u].presenter),o[u]=$dhx.ui.mvp.views.get(p[u].view),s[u].view=o[u],s[u].view._wrapper=r._wrapper,s[u].view.app={mainView:$dhx.ui.mvp.views.get("view"),_child_presenters:s,_child_views:o},s[u].model=i.presenter.model,s[u]._subscriber=s[u].subscriber||function(e,t){console.log("Child Presenter subescriber defined in $dhx.ui.mvp Received Message: ",t)},s[u]._subscriber_token=$dhx.ui.Mediator.listen(Object.keys($dhx.ui.mvp.model.engine.get(n.stash.model.engine).schema.io).join()+":changeModel",s[u]._subscriber),o[u].presenter=s[u],s[u].start(),o[u].initialize(),o[u].render(i.presenter._model,s[u]),$dhx.MQ.publish(s[u].topic,{action:"start",target:null});var e=[];p[u].append_views&&p[u].append_views.forEach(function(t){e.push(n.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+Object.keys(t)[0]+".js"),e.push(n.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+Object.keys(t)[0]+".js")}),$dhx.onDemand.require(e,function(){p[u].append_views&&p[u].append_views.forEach(function(e){o[u][e[Object.keys(e)[0]]]=$dhx.ui.mvp.views.get(Object.keys(e)[0]),o[u][e[Object.keys(e)[0]]].presenter=$dhx.ui.mvp.presenters.get(Object.keys(e)[0]),o[u][e[Object.keys(e)[0]]].presenter.model=i.presenter.model,o[u][e[Object.keys(e)[0]]].presenter.view=o[u][e[Object.keys(e)[0]]]})})})}},e.destroy_active_route=function(){n.last_active_route=n.active_route,s[n.last_active_route]&&(s[n.last_active_route].destroy&&s[n.last_active_route].destroy(),o[n.last_active_route].destroy&&o[n.last_active_route].destroy(),$dhx.ui.Mediator.unlisten(s[n.last_active_route]._subscriber_token),o[n.last_active_route]=null,s[n.last_active_route]=null,delete o[n.last_active_route],delete s[n.last_active_route])},e.views={views:[],declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.views.views[n]=t[n]},get:function(t){return t=t.toString().replace(/\//g,""),e.views.views[t]||!1}},e.presenters={presenters:[],declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.presenters.presenters[n]=t[n]},get:function(t){return t=t.toString().replace(/\//g,""),e.presenters.presenters[t]||!1}},e.models={models:[],declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.models.models[n]=t[n]},get:function(t){return t=t.toString().replace(/\//g,""),e.models.models[t]||!1}},e.ui={isMobile:!1,window_manager:null,window_manager_is_ready:!1,_window_manager:function(t){var n=e.ui;n.window_manager_is_ready||(n.window_manager=new dhtmlXWindows({}),n.window_manager_is_ready=!0)},window:function(t){var n=e.ui;return n.window_manager_is_ready||n._window_manager(),n.window_manager.createWindow(t)},askNotificationPermission:function(e){Notification.requestPermission(function(t){if("permission"in Notification||(Notification.permission=t),e.onSuccess&&e.onSuccess(t),"granted"===t){new Notification("Notification test",{body:"it is working!",icon:n.root+"assets/images/notification.png"})}})},askLocationPermission:function(e){},getQuota:function(e,t){var i=window.webkitStorageInfo||navigator.webkitTemporaryStorage||navigator.webkitPersistentStorage||!1;if(!i){var r=$dhx.Browser.name+" does not provide quota management.";return $dhx.notify("Quota information",r,n.root+"assets/images/notification.png"),void(t&&t(r))}i.queryUsageAndQuota(i.TEMPORARY,function(t,n){t=(t/1024/1024/1024).toFixed(5),n=(n/1024/1024/1024).toFixed(2),e&&e(t,n)},function(e){t&&t(e),console.log("Error",e)})}},e.model={_collections:{},collection:{declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.model._collections[n]=t[n]},get:function(t){return t=t||!1,t?(t=t.toString().replace(/\//g,""),e.model._collections[t]||!1):e.model._collections}},_engines:{},engine:{declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.model._engines[n]=t[n]},get:function(t){return t=t.toString().replace(/\//g,""),e.model._engines[t]||!1}},_models:{},declare:function(t){var n=Object.keys(t)[0];n=n.toString().replace(/\//g,""),e.model._models[n]=t[n]},get:function(t){return t?(t=t.toString().replace(/\//g,""),e.model._models[t]||!1):e.model._models},helpers:{schema:{record:function(t){var n=this,i={},r=["_id","id","__v"],o=e.model.get(t.model);t.record=JSON.parse(JSON.stringify(t.record));for(var s in t.record)r.contains(s)||s in o&&(i[s]=t.record[s]);for(var d in o)r.contains(d)||("undefined"!=typeof i[d]?("date"==o[d].type.toLowerCase()?$dhx.isDate(i[d])||console.warn("error creating record object",i[d]):"array"==o[d].type.toLowerCase()?$dhx.isArray(i[d])||console.warn("bad record property: ",d):"string"==o[d].type.toLowerCase()||"number"==o[d].type.toLowerCase()?typeof i[d]!==o[d].type.toLowerCase()&&console.warn("bad record property: ",d):console.warn("Unknow type. bad record property: ",d),(o[d].validate.required||(o[d].validate.rules||"").indexOf("NotEmpty")>-1)&&(""!==i[d]&&null!==i[d]||console.warn("bad record value: ",i[d]))):(console.info("setting default value ("+o[d]["default"]+") for "+d),i[d]=o[d]["default"]));t.record.__v&&(i.__v=t.record.__v),t.record.id?i.id=t.record.id:i.id=$dhx.guid(),i._id=i.id;for(var a in i)n[a]=i[a]},defaults:{__v:{type:"number","default":0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"__v",type:"hidden"},grid:{header:"__v",align:"left",coltype:"ro",width:"0"}}},_id:{type:"string","default":0,unique:!0,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"_id",type:"hidden"},grid:{header:"_id",align:"left",coltype:"ro",width:"0"}}}}}}}}($dhx.ui.mvp=$dhx.ui.mvp||{});