!function(e){"use strict"}(window.$dhx=window.$dhx||{}),function(e){"use strict"}($dhx.ui=$dhx.ui||{}),function(e){"use strict";var t,r,i,n,s=[],o=[],d=[],p={},a=function(i){"undefined"==typeof i.appId&&(i.appId=""+Math.random()),this.appId=i.appId,this.container=i.container,this.root=i.root,this.icons_path=i.icons_path||i.root+"assets/icons/64/",this.deps_path=i.deps_path||i.root+"deps/",this.lib_path=i.lib_path||i.root+"lib/",this.stash=i,t=i.root,p=i,p.from="super";var n=e.triggerMethod("before:start",p);if(!n)throw" application will not initialize due a onBeforeStart event returning false";this.initialize(p),this.active_route=!1,this.last_active_route=!1,r=this},u=function(e){i=this},h=function(t){h=e.copyTo(h,t),this.appId=r.appId,this.container=r.container,this.root=r.root,this.icons_path=r.icons_path,this.dispatch=function(e){i.dispatch(e,!0),this.onDispatch&&this.onDispatch(e)},n=this},c=function(t){c=e.copyTo(c,t),this.appId=r.appId,this.container=r.container,this.root=r.root,this.icons_path=r.icons_path},l=function(e){return e.topic=r.appId+".presenter",e._view.topic=r.appId+".view",e._model.topic=r.appId+".model",e._subscriber=e._subscriber||function(t,r){t==e._view.topic||t==e._model.topic},e._subscriber_view_token=$dhx.MQ.subscribe(e._view.topic,e._subscriber),e._subscriber_model_token=$dhx.MQ.subscribe(e._model.topic,e._subscriber),e._view._subscriber=e._view._subscriber||function(e,t){},e._view._subscriber_presenter_token=$dhx.MQ.subscribe(e.topic,e._view._subscriber),e._model._subscriber=e._model._subscriber||function(e,t){},e._model._subscriber_presenter_token=$dhx.MQ.subscribe(e.topic,e._model._subscriber),e};a.prototype={initialize:function(e){},start:function(t){var i=(window.location.hash,[]),n=[],s=[],o=[];t=t||{},n.push(r.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+"presenter.js"),n.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+"view.js"),i.push(r.deps_path+"thirdparty/codebase5.0_std/dhtmlx.css"),i.push(r.deps_path+"thirdparty/codebase5.0_std/dhtmlx.js"),i.push(r.deps_path+"thirdparty/signals.js"),i.push(r.deps_path+"thirdparty/hasher.js"),i.push(r.deps_path+"thirdparty/crossroads.js"),i.push(r.deps_path+"dhx/min.dhx.MQ.js"),i.push(r.deps_path+"dhx/dhx.ui.router.js"),t.full?(i.push(r.deps_path+"thirdparty/jquery.min.js"),i.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),i.push(r.deps_path+"dhx/min.dhx.ui.i18n.js"),i.push(r.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),i.push(r.deps_path+"thirdparty/moment.min.js"),i.push(r.deps_path+"thirdparty/moment-timezone-with-data.min.js"),i.push(r.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),i.push(r.deps_path+"dhx/min.dhx.excells.js"),i.push(r.deps_path+"dhx/min.dhx.crypt.js"),i.push(r.deps_path+"thirdparty/ie10-viewport-bug-workaround.js"),i.push(r.deps_path+"thirdparty/min.underscore.js"),i.push(r.deps_path+"thirdparty/backbone-min.js"),i.push(r.deps_path+"thirdparty/min.backbone-indexeddb.js"),i.push(r.deps_path+"dhx/min.dhx.component.js"),i.push(r.deps_path+"dhx/min.dhx.dhtmlx.js"),i.push(r.deps_path+"dhx/min.dhx.ui.form.js")):(t.stripe&&i.push("https://js.stripe.com/v2/"),t.pouch&&i.push("https://cdn.jsdelivr.net/pouchdb/5.4.5/pouchdb.min.js"),t.backboneIDB&&(i.push(r.deps_path+"thirdparty/min.underscore.js"),i.push(r.deps_path+"thirdparty/backbone-min.js"),i.push(r.deps_path+"thirdparty/min.backbone-indexeddb.js")),t.$dhx_crypt&&i.push(r.deps_path+"dhx/min.dhx.crypt.js"),(t.$dhx_grid||t.$dhx_form)&&(i.push(r.deps_path+"thirdparty/jquery.min.js"),i.push(r.deps_path+"dhx/min.dhx.ui.i18n.js"),i.push(r.deps_path+"dhx/min.dhx.ui.i18n.en-us.js"),i.push(r.deps_path+"thirdparty/moment.min.js"),i.push(r.deps_path+"thirdparty/moment-timezone-with-data.min.js"),i.push(r.deps_path+"dhx/min.dhtmlx_grid_moment_type.js"),i.push(r.deps_path+"dhx/min.dhx.component.js"),i.push(r.deps_path+"thirdparty/creditcard.min.js")),t.$dhx_grid&&i.push(r.deps_path+"dhx/min.dhx.excells.js"),t.$dhx_form&&(i.push(r.deps_path+"dhx/min.dhx.dhtmlx.js"),i.push(r.deps_path+"dhx/min.dhx.ui.form.js"))),r.stash.model.models&&r.stash.model.models.forEach(function(e){s.push(r.lib_path+"model/models/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),r.stash.model.collections&&r.stash.model.collections.forEach(function(e){s.push(r.lib_path+"model/collections/"+("test"!=$dhx.environment?"min.":"")+e+".js")}),r.stash.model.engine?o=[r.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+r.stash.model.engine+".js"]:(r.stash.model.engine="backboneIDB",o=[r.lib_path+"model/engines/"+("test"!=$dhx.environment?"min.":"")+r.stash.model.engine+".js"]),$dhx.onDemand.require(i,function(){$dhx.onDemand.require(s,function(){$dhx.onDemand.require(o,function(){$dhx.onDemand.require(n,function(){e.start_all()})})})})}},u.prototype={dispatch:function(e,t){this.router;"#"!=e?($dhx.ui.router.routeTo(e),$dhx.ui.router.router.resetState()):(window.location.hash="/",r.active_route=e)},route:function(e){this.routes[e.url]=e}},h.prototype={initialize:function(e){}},c.prototype={initialize:function(e){}},e.router={extend:function(t){var r=function(){console.log("start from extend factory")};return e.extend({base:u,factory:t,onBeforeExtend:function(e){e=e||{},e.presenter=e.presenter||{start:r},e.presenter.start=e.presenter.start||r,e.routes=e.routes||{},e.routes.hasOwnProperty("#")||(e.routes["#"]={url:"#",method:"start"})}})}},e.application={extend:function(t){return e.extend({base:a,factory:t,onBeforeExtend:function(){}})}},e.main_view={extend:function(t){return e.extend({base:h,factory:t,onBeforeExtend:function(){}})}},e.child_view={extend:function(t){return e.extend({base:c,factory:t,onBeforeExtend:function(){}})}},e.start_all=function(){e.setup_routes(),e.setup_models(),e.setup_collections(),e.start_model()},e.setup_routes=function(){var e=function(e){};console.log(i.routes);for(var t in i.routes)"#"!=t&&(console.info("Route setup: ",t),$dhx.ui.router.addRoute(t,e))},e.start_model=function(){var t=$dhx.ui.mvp.presenters.get("presenter"),n=$dhx.ui.mvp.views.get("view"),s=$dhx.ui.mvp.model.engine.get(r.stash.model.engine);s.start({onSuccess:function(){console.info("model started"),s.schema.start({onSuccess:function(){n.model=s,n.rendered=!1,n.initialize(),t._view=n,t.view=n,t._model=s,t.model=s,t=l(t),r.presenters=$dhx.ui.mvp.presenters,r.views=$dhx.ui.mvp.views,i.presenter=t,n._router=i,n.presenter=t,r.main_presenter=t,r.main_view=n,e.app_started||e.start_app()}})}})},e.setup_models=function(){r.stash.model.models.forEach(function(e){var t={};t[e]=function(e){"strict";return e}(window[e]),$dhx.ui.mvp.model.declare(t)})},e.setup_collections=function(){r.stash.model.collections.forEach(function(e){var t={};t[e]=function(e){"strict";return e.defaults=$dhx.ui.mvp.model.get(e.model),e.item=e.model,e}(window[e]),$dhx.ui.mvp.model.collection.declare(t)})},e.queryString=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},e.app_started=!1,e.start_app=function(){var t=$dhx.ui.router.request_url||"";"#/"==t&&(t=""),""!==t&&(t=t.toString().replace(/#/,"")),i.dispatch("#"),$dhx.ui.mvp.presenters.get("presenter").start(),e.triggerMethod("start",p),$dhx.ui.i18n&&$dhx.ui.i18n.start(),$dhx.excells&&$dhx.excells.init(),""!==t?i.presenter._view.render({onSuccess:function(r){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),r.onComplete&&r.onComplete(t)},ok:function(r){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0,$dhx.ui.mvp.views.get("view").dispatch(t),r.onComplete&&r.onComplete(t)},onFail:function(){}}):i.presenter._view.render({onSuccess:function(){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0},ok:function(){e.triggerMethod("render",p),$dhx.ui.mvp.views.get("view").rendered=!0},onFail:function(){}}),$dhx.MQ.publish(i.presenter.topic,{action:"start",target:null}),e.app_started=!0},e.extend=function(t){var r=t.base,i=t.factory,n=null;return t.onBeforeExtend&&t.onBeforeExtend(i),n=function(e){e=e||{},r.call(this,e)},n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n=e.copyTo(n,i),n.on=function(e,t){d.push({pattern:e,fn:t,base:r})},n.start=function(e){p=e},n},e.copyTo=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e.prototype[r]=t[r]);return e},e.triggerMethod=function(){var e=arguments[0],t=arguments[1]||!1,r=[];return d.forEach(function(i){i.pattern===e&&(t?r.push(i.fn(t)):r.push(i.fn()))}),!(r.join(".").indexOf("false")>-1)},e.loadModule=function(e,t){var d="start",p=i,a=p.routes,u=null,h=!1,c=eval,_=c(t.route._matchRegexp);for(var m in p.routes)_.test(m)&&(h=!0);if(!h)throw"Undeclared "+e+" route";if(u=t.route._pattern,!(u in p.routes))throw"Undeclared "+u+" route";if(p.routes[u].method&&(d=p.routes[u].method),r.active_route&&"#"!=r.active_route&&r.active_route!=u&&(r.last_active_route=r.active_route,o[r.last_active_route].destroy(),s[r.last_active_route].destroy(),$dhx.MQ.unsubscribe(s[r.last_active_route]._subscriber_presenter_token),$dhx.MQ.unsubscribe(o[r.last_active_route]._subscriber_model_token),$dhx.MQ.unsubscribe(o[r.last_active_route]._subscriber_view_token),s[r.last_active_route]=null,o[r.last_active_route]=null,delete s[r.last_active_route],delete o[r.last_active_route]),r.active_route=u,"#"!=u&&(a[u].presenter=a[u].presenter||u,a[u].view=a[u].view||u),a[u].presenter){var v=[];a[u].view&&v.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+a[u].view+".js"),v.push(r.lib_path+"presenter/"+("test"!=$dhx.environment?"min.":"")+a[u].presenter+".js"),a[u].append_views&&a[u].append_views.forEach(function(e){v.push(r.lib_path+"view/"+("test"!=$dhx.environment?"min.":"")+e[Object.keys(e)[0]]+".js")}),$dhx.onDemand.load(v,function(){o[u]=$dhx.ui.mvp.presenters.get(a[u].presenter),s[u]=$dhx.ui.mvp.views.get(a[u].view),a[u].append_views&&a[u].append_views.forEach(function(e){s[u][Object.keys(e)[0]]=window[e[Object.keys(e)[0]]]}),o[u]._view=s[u],o[u]._view._wrapper=n._wrapper,o[u]._view.app={mainView:$dhx.ui.mvp.views.get("view"),_child_presenters:o,_child_views:s},o[u]._view.window_manager=n.window_manager,o[u].model=i.presenter._model,o[u].view=s[u],o[u]._model||(o[u]._model=i.presenter._model),o[u]=l(o[u]),s[u].model=i.presenter._model,s[u].presenter=o[u],o[u].start(),s[u].initialize(),s[u].render(i.presenter._model,o[u]),$dhx.MQ.publish(o[u].topic,{action:"start",target:null})})}},e.views={views:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.views.views[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.views.views[t]||!1}},e.presenters={presenters:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.presenters.presenters[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.presenters.presenters[t]||!1}},e.models={models:[],declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.models.models[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.models.models[t]||!1}},e.model={_collections:{},collection:{declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._collections[r]=t[r]},get:function(t){return t=t||!1,t?(t=t.toString().replace(/\//g,""),e.model._collections[t]||!1):e.model._collections}},_engines:{},engine:{declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._engines[r]=t[r]},get:function(t){return t=t.toString().replace(/\//g,""),e.model._engines[t]||!1}},_models:{},declare:function(t){var r=Object.keys(t)[0];r=r.toString().replace(/\//g,""),e.model._models[r]=t[r]},get:function(t){return t?(t=t.toString().replace(/\//g,""),e.model._models[t]||!1):e.model._models},helpers:{schema:{record:function(t){var r=this,i={},n=["_id","id","__v"],s=e.model.get(t.model);t.record=JSON.parse(JSON.stringify(t.record));for(var o in t.record)n.contains(o)||o in s&&(i[o]=t.record[o]);for(var d in s)if(!n.contains(d))if("undefined"!=typeof i[d]){if(typeof i[d]!==s[d].type.toLowerCase())throw console.warn("error creating record object"),"Invalid type for "+d+". It should be "+s[d].type.toLowerCase()+", but you passed "+typeof i[d];if((s[d].validate.required||(s[d].validate.rules||"").indexOf("NotEmpty")>-1)&&(""===i[d]||null===i[d]))throw console.warn("error creating record object"),"You need to provide a value for "+d+". It should be "+s[d].type.toLowerCase()+"."}else console.info("setting default value ("+s[d]["default"]+") for "+d),i[d]=s[d]["default"];t.record.__v&&(i.__v=t.record.__v),t.record.id&&(i.id=t.record.id),t.record._id&&(i._id=t.record._id);for(var p in i)r[p]=i[p]},defaults:{__v:{type:"number","default":0,unique:!1,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"__v",type:"hidden"},grid:{header:"__v",align:"left",coltype:"ro",width:"0"}}},_id:{type:"string","default":0,unique:!0,validate:{required:!0,mask_to_use:"",rules:""},ui:{form:{label:"_id",type:"hidden"},grid:{header:"_id",align:"left",coltype:"ro",width:"0"}}}}}}}}($dhx.ui.mvp=$dhx.ui.mvp||{});